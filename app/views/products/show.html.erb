<div class="row justify-content-center">
<div class="col-6 border p-1 m-2">
<h1 class="text-center mt-3 m-2 bg-primary rounded shadow">Product</h1>
<div class="m-3 p-1 border text-center">
    <h2><%= @product.title %></h2>
    <%= (@product.image.attached?) ? image_tag(@product.image, size: "220x220") : "" %>
    <hr>
    <p>Price: <%= @product.price %> | AvailableQuantity: <%= @product.quantity %></p>
    <p>Category: <%= @product.category.name %> | Brand: <%= @product.brand.name %> | Store: <%= @product.store.name %></p>
    <h5>Product Description</h5>
    <p class="border rounded mt-3 p-1 mb-3"><%= @product.description %></p>
    <hr>

    <p>Rate: <%= @rate.product_rate(@product) %> | Reviewers: <%= @rate.reviewers(@product) %></p>
    <br>
    <div class="text-center">
        <% if can? :edit, @product %>
            <%= link_to "Edit", edit_product_path(@product.id), class: 'btn btn-primary shadow' %>
        <% end %>
        <% if can? :destroy, @product %>
            | <%= link_to 'Delete', product_path(@product),
            method: :delete,
            data: { confirm: 'Are you sure you want to delete this product?' },
            class: 'btn btn-danger shadow' %>
        <% end%>
    </div>


    <div class="border border-primary shadow rounded p-2 m-3 text-center">

        <% if @product.quantity > 0 %>
            <% if current_user %>
                <%= form_with(url: add_to_cart_path(@product.id), method: "post") do |form| %>
                        <%= form.number_field :quantity ,value: 1, min: 1, max: @product.quantity %>
                        <%= form.submit "Add to Cart", :class => 'btn btn-sm btn-warning text-dark shadow' %>
                <% end %>
            <% else %>
                <%= link_to "Add To Cart", add_to_cart_path(@product.id), class: 'btn btn-warning text-dark', method: :post %>
            <% end %>
        <% else %>
            <h5 class="bg-secondary m-4">Out of stock</h5>
        <% end %>
        <% if current_user && current_user.id != @product.store.user_id %>
            <hr>
            <% if @rate.check_rate(@product, current_user.id) %>
                    <%= form_with(url: rate_product_path(@product.id), method: "post") do |f| %>
                        <div class="border d-inline p-3 rounded mr-2">
                            <input type="range" name="rate" min="0" max="5" value="0" oninput="display.value=this.value" />
                            <input type="number" name="display" value="0" min="0" max="5" oninput="rate.value=this.value"/>
                        </div>
                            <%= f.submit "Rate", :class => 'btn btn-sm btn-outline-primary shadow' %>
                    <% end %>
            <% else %>

            <h5 class="bg-info">Your Rate: <%= @rate.get_rate(@product, current_user.id) %></h5>
            <% end %>
            <hr>
            <% if (Review.new).check_reviews(@product, current_user.id) %>
                <%= form_with(url: comment_product_path(@product.id), method: "post") do |f| %>
                    <%= f.text_field :comment %>
                    <%= f.submit "review", :class => 'btn btn-sm btn-outline-secondary shadow' %>
                <% end %>
            <% end %>
        <% end %>

        </div>
        <% if !@reviews.empty? %>
        <div class="p-3 m-2 text-center">
            <h4 class="mb-3 bg-success p-1">Reviews</h4>
            <% @reviews.each do |review| %>
                <% unless review.user_id == current_user.id %>
                    <div class="mb-2 border"><b><%= review.user.name %> :</b> <%= review.comment %></div>
                <% else %>
                    <div class="mb-2 border bg-info"><b><%= review.user.name %> :</b> <%= review.comment %></div>
                <% end %>
            <% end %>
        </div>

    </div>
    <div class="text-center mt-2 mb-1">
        <%= link_to "Products", products_path, class: 'btn btn-outline-primary' %>
    </div>
</div>
</div>